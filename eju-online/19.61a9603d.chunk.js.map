{"version":3,"sources":["pages/Setting/ChangePwd/ChangePwd.tsx"],"names":["ChangePwd","history","useHistory","useState","formValues","setFormValues","useMutation","CHANGE_PWD","onCompleted","loginRes","changeSuccess","handleChangePwd","data","changePassword","goBack","handleChange","value","type","vals","placeholder","name","onChange","val","size","mt","onClick","oldPassword","password","surePassword","info","pwdReg","test","checlValues","variables","md5","toString","newPassword"],"mappings":"sUA0FeA,EAhFa,WAC1B,IAAMC,EAAUC,cAChB,EAAoCC,mBAA0B,IAA9D,mBAAOC,EAAP,KAAmBC,EAAnB,KACA,EAA0BC,YAAYC,IAAY,CAChDC,YAAa,SAACC,GAAD,OAAcC,EAAcD,MADpCE,EAAP,oBAKMD,EAAgB,SAACE,IAEjB,OAAJA,QAAI,IAAJA,OAAA,EAAAA,EAAMC,iBAAkBZ,EAAQa,UAqC5BC,EAAe,SAACC,EAAeC,GACnCZ,GAAc,SAACa,GAAD,mBAAC,eAAeA,GAAhB,kBAAuBD,EAAOD,QAE9C,OACE,kBAAC,IAAD,KACE,kBAAC,IAAD,iCACA,uBACEG,YAAY,uCACZF,KAAK,WACLG,KAAK,cACLC,SAAU,SAACC,GAAD,OAAeP,EAAaO,EAAK,kBAE7C,uBAAYC,KAAK,OACjB,uBACEJ,YAAY,uCACZF,KAAK,WACLG,KAAK,WACLC,SAAU,SAACC,GAAD,OAAeP,EAAaO,EAAK,eAE7C,uBAAYC,KAAK,OACjB,uBACEJ,YAAY,6CACZF,KAAK,WACLG,KAAK,eACLC,SAAU,SAACC,GAAD,OAAeP,EAAaO,EAAK,mBAE7C,kBAAC,IAAD,CAAeL,KAAK,UAAUO,GAAG,QAAQC,QArCxB,YAvBD,WAClB,IAAQC,EAAwCtB,EAAxCsB,YAAaC,EAA2BvB,EAA3BuB,SAAUC,EAAiBxB,EAAjBwB,aAC/B,QAAQ,GACN,MAAOF,EACL,IAAMG,KAAK,wCACX,MACF,MAAOF,EACL,IAAME,KAAK,wCACX,MACF,KAAKC,IAAOC,KAAKJ,GAAY,IAC3B,IAAME,KAAK,sIACX,MACF,KAAKD,IAAiBD,EAEpB,IAAME,KAAK,sEACX,MACF,QACE,OAAO,EAEX,OAAO,GAKHG,IACFrB,EAAgB,CACdsB,UAAW,CACTP,YAAaQ,IAAI9B,EAAWsB,aAAe,IAAIS,WAC/CC,YAAaF,IAAI9B,EAAWuB,UAAY,IAAIQ,gBAgChD","file":"19.61a9603d.chunk.js","sourcesContent":["import React, { useState } from 'react';\r\nimport { WhiteSpace, InputItem, Toast } from 'antd-mobile';\r\nimport { useHistory } from 'react-router-dom';\r\nimport { useMutation } from '@apollo/client';\r\nimport { CHANGE_PWD } from '@/helpers/APIHelper';\r\nimport md5 from 'crypto-js/md5';\r\nimport { ChangePwdValues } from '../types';\r\nimport { pwdReg } from '../../Login/regs';\r\nimport { Page, PageTitle, PrimaryButton } from '../../Login/styles';\r\n\r\nconst ChangePwd: React.FC = () => {\r\n  const history = useHistory();\r\n  const [formValues, setFormValues] = useState<ChangePwdValues>({}); // 表单值\r\n  const [handleChangePwd] = useMutation(CHANGE_PWD, {\r\n    onCompleted: (loginRes) => changeSuccess(loginRes),\r\n  });\r\n\r\n  // 修改成功后\r\n  const changeSuccess = (data: { changePassword: boolean }): void => {\r\n    console.log(data);\r\n    data?.changePassword && history.goBack();\r\n  };\r\n  // 表单校验\r\n  const checlValues = (): boolean => {\r\n    const { oldPassword, password, surePassword } = formValues;\r\n    switch (false) {\r\n      case !!oldPassword:\r\n        Toast.info('请输入旧密码');\r\n        break;\r\n      case !!password:\r\n        Toast.info('请输入新密码');\r\n        break;\r\n      case pwdReg.test(password || ''):\r\n        Toast.info('请输入8-24位包含大小写字母数字及特殊字符的密码');\r\n        break;\r\n      case surePassword === password:\r\n        console.log(surePassword, password, surePassword !== password);\r\n        Toast.info('确认密码与密码保持一致');\r\n        break;\r\n      default:\r\n        return true;\r\n    }\r\n    return false;\r\n  };\r\n\r\n  // 提交更改密码\r\n  const handleSubmit = (): void => {\r\n    if (checlValues()) {\r\n      handleChangePwd({\r\n        variables: {\r\n          oldPassword: md5(formValues.oldPassword || '').toString(),\r\n          newPassword: md5(formValues.password || '').toString(),\r\n        },\r\n      });\r\n    }\r\n  };\r\n  // 表单值改变\r\n  const handleChange = (value: string, type: string): void => {\r\n    setFormValues((vals) => ({ ...vals, [type]: value }));\r\n  };\r\n  return (\r\n    <Page>\r\n      <PageTitle>更改密码</PageTitle>\r\n      <InputItem\r\n        placeholder=\"请输入原密码\"\r\n        type=\"password\"\r\n        name=\"oldPassword\"\r\n        onChange={(val): void => handleChange(val, 'oldPassword')}\r\n      />\r\n      <WhiteSpace size=\"lg\" />\r\n      <InputItem\r\n        placeholder=\"请输入新密码\"\r\n        type=\"password\"\r\n        name=\"password\"\r\n        onChange={(val): void => handleChange(val, 'password')}\r\n      />\r\n      <WhiteSpace size=\"lg\" />\r\n      <InputItem\r\n        placeholder=\"请输入确认密码\"\r\n        type=\"password\"\r\n        name=\"surePassword\"\r\n        onChange={(val): void => handleChange(val, 'surePassword')}\r\n      />\r\n      <PrimaryButton type=\"primary\" mt=\"286px\" onClick={handleSubmit}>\r\n        提交\r\n      </PrimaryButton>\r\n    </Page>\r\n  );\r\n};\r\n\r\nexport default ChangePwd;\r\n"],"sourceRoot":""}