{"version":3,"sources":["pages/Library/Quick/AnswerModal.tsx","pages/Library/Quick/Quick.tsx"],"names":["Answer","props","useMutation","SUBMIT_ANSWER","onCompleted","res","handleSubmitSuccess","submitAnswer","loading","state","useContext","ProviderContext","hide","tag","answerNum","answer","getTimeCounter","history","replace","useEffect","type","onClick","answerItemArr","i","push","className","key","getAnswer","quick","quickTrueAnswer","ids","userAnswers","pointsArr","trueNum","_id","answerValue","prevTrueItem","point","getUrlParams","subject","tagId","sourceType","timeCounter","variables","points","accuracy","moduleType","Quick","useState","aswArr","setAswArr","isShowResult","setIsShowResult","useLazyQuery","QUICK_QUESTION","getQuestion","data","answerShow","setAnswerShow","dispatch","swiperRef","useRef","swiperPageRef","smartQuestions","useHistory","questionLen","length","cutDownRef","handleQuestionChange","current","swipeNext","trueAnswer","forEach","item","checkAnswer","id","color","go","CutDown","ref","defaultIndex","loop","indicator","total","onIndexChange","document","getElementById","scrollTo","setTimeout","map","index","question","questionId","options","Item","getMathpix","optionItem","idx","questionNum","numToLetter","selectAnswer","Layer","effect","needCloseTag","visible","stop"],"mappings":"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","file":"9.1757b4c8.chunk.js","sourcesContent":["import React, { ReactElement, useContext, useEffect } from 'react';\r\nimport { Button, Icon, Toast } from 'antd-mobile';\r\nimport history from '@/utils/history';\r\nimport { useMutation } from '@apollo/client';\r\nimport { ProviderContext } from '@/reducer/context';\r\nimport { SUBMIT_ANSWER } from '@/helpers/APIHelper';\r\nimport getUrlParams from '@/utils/get-url-params';\r\nimport {\r\n  AnswerInner,\r\n  AnswerLabel,\r\n  AnswerList,\r\n  AnswerListBox,\r\n  AnswerListItem,\r\n  AnswerModal,\r\n  AnswerTitle,\r\n  CloseBox,\r\n} from './styles';\r\nimport { ButtonBox } from '../styles';\r\n\r\ninterface AnserProps {\r\n  hide: () => void;\r\n  answer: { [key: number]: string };\r\n  tag: string;\r\n  answerNum: number;\r\n  getTimeCounter: () => number;\r\n}\r\nconst Answer: React.FC<AnserProps> = (props): ReactElement => {\r\n  const [submitAnswer, { loading }] = useMutation(SUBMIT_ANSWER, {\r\n    onCompleted: (res) => handleSubmitSuccess(res),\r\n  });\r\n  const { state } = useContext(ProviderContext);\r\n\r\n  const { hide, tag, answerNum, answer, getTimeCounter } = props;\r\n  console.log('props++++++++', props);\r\n\r\n  // 获取已答答案\r\n  const getAnswer = (): ReactElement[] => {\r\n    const answerItemArr = [];\r\n    for (let i = 0; i < answerNum; i += 1) {\r\n      if (answer[i as keyof typeof answer]) {\r\n        answerItemArr.push(\r\n          <AnswerListItem className=\"true\" key={i + 1}>\r\n            {i + 1}\r\n          </AnswerListItem>\r\n        );\r\n      } else {\r\n        answerItemArr.push(\r\n          <AnswerListItem key={i + 1}>{i + 1}</AnswerListItem>\r\n        );\r\n      }\r\n    }\r\n    return answerItemArr;\r\n  };\r\n\r\n  // 提交答题卡\r\n  const handleSubmit = (): void => {\r\n    const { quick, quickTrueAnswer } = state;\r\n    const ids = [];\r\n    const userAnswers = [];\r\n    // let abilityValue = 0;\r\n    const pointsArr = [];\r\n    let trueNum = 0;\r\n    for (let i = 0; i < answerNum; i += 1) {\r\n      ids.push(quick?.[i]?._id || '');\r\n      const answerValue = answer[i as keyof typeof answer];\r\n      userAnswers.push([answerValue || '']);\r\n      const prevTrueItem = quickTrueAnswer?.[i];\r\n      if (prevTrueItem?.answer === answerValue) {\r\n        // abilityValue += prevTrueItem?.point;\r\n        trueNum += 1;\r\n        pointsArr.push(prevTrueItem?.point);\r\n      } else {\r\n        pointsArr.push(0);\r\n      }\r\n    }\r\n    const { subject, tagId, sourceType } = getUrlParams();\r\n    const timeCounter = getTimeCounter();\r\n    const param = {\r\n      ids,\r\n      userAnswers,\r\n      points: pointsArr,\r\n      accuracy: trueNum / answerNum,\r\n      timeCounter,\r\n      subject,\r\n      tagId,\r\n      sourceType,\r\n      moduleType: '0',\r\n    };\r\n    console.log('param++++++++++++++', param);\r\n    submitAnswer({ variables: param });\r\n  };\r\n  // 提交成功回调\r\n  const handleSubmitSuccess = (res: {\r\n    success: boolean;\r\n    message?: string;\r\n  }): void => {\r\n    console.log('handleSubmitSuccess++++', res);\r\n    hide();\r\n    history.replace(`/quick-result?tag=${tag}&timeCounter=${getTimeCounter()}`);\r\n  };\r\n  useEffect(() => {\r\n    loading ? Toast.loading('提交中', 0) : Toast.hide();\r\n  }, [loading]);\r\n  return (\r\n    <AnswerModal>\r\n      <AnswerInner>\r\n        <AnswerTitle>\r\n          答题卡\r\n          <CloseBox>\r\n            <Icon type=\"cross\" onClick={(): void => hide()} />\r\n          </CloseBox>\r\n        </AnswerTitle>\r\n        <AnswerListBox>\r\n          <AnswerLabel>{tag}</AnswerLabel>\r\n          <AnswerList>{getAnswer()}</AnswerList>\r\n        </AnswerListBox>\r\n        <ButtonBox>\r\n          <Button type=\"primary\" onClick={handleSubmit}>\r\n            确定提交\r\n          </Button>\r\n        </ButtonBox>\r\n      </AnswerInner>\r\n    </AnswerModal>\r\n  );\r\n};\r\n\r\nexport default Answer;\r\n","import { Icon, Button, Toast } from 'antd-mobile';\r\nimport React, { useContext, useEffect, useRef, useState } from 'react';\r\nimport { useHistory } from 'react-router-dom';\r\nimport { Swiper } from 'antd-mobile-v5';\r\nimport { SwiperRef } from 'antd-mobile-v5/es/components/swiper';\r\nimport { useLazyQuery } from '@apollo/client';\r\nimport { QUICK_QUESTION } from '@/helpers/APIHelper';\r\nimport getUrlParams from '@/utils/get-url-params';\r\nimport { LayerContainer } from '@/components/Layer';\r\nimport { numToLetter } from '@/constants/globalDatas';\r\nimport { ProviderContext } from '@/reducer/context';\r\nimport { TrueAnswer } from '@/reducer/reducer';\r\nimport {\r\n  Page,\r\n  HeaderBox,\r\n  GrayFont,\r\n  FontContent,\r\n  CarouseBox,\r\n  ButtonBox,\r\n  ButtonBoxInner,\r\n  HeaderBlank,\r\n  HeaderInner,\r\n  ButtonBlank,\r\n} from '../styles';\r\nimport { AnswerBox, AnswerItem } from './styles';\r\nimport Answer from './AnswerModal';\r\nimport getMathpix from '../utils/getMathpix';\r\nimport CutDown from '../components/CutDown';\r\n\r\nconst Quick: React.FC = () => {\r\n  const [aswArr, setAswArr] = useState({}); // 选择的答案集合\r\n  const [isShowResult, setIsShowResult] = useState(false); // 是否展示查看结果按钮\r\n  const [getQuestion, { data, loading }] = useLazyQuery(QUICK_QUESTION); // 获取题目列表\r\n  const [answerShow, setAnswerShow] = useState(false); // 是否展示答案弹窗\r\n  const { dispatch } = useContext(ProviderContext);\r\n  const swiperRef = useRef<SwiperRef>(null);\r\n  const swiperPageRef = useRef(1); // 默认在第一页\r\n\r\n  const { smartQuestions } = data || {};\r\n  const history = useHistory();\r\n  const { subject, tagId, tag } = getUrlParams();\r\n  const questionLen = smartQuestions?.length || 0; // 题目数\r\n\r\n  const cutDownRef = useRef<{ stop: () => number }>();\r\n  // 选择答案\r\n  const handleSelectAnswer = (questionNum: number, answerNum: number): void => {\r\n    setAswArr((item) => {\r\n      return {\r\n        ...item,\r\n        [questionNum]: numToLetter[answerNum as keyof typeof numToLetter], // 转换成ABCD\r\n      };\r\n    });\r\n    setTimeout(() => {\r\n      swiperPageRef.current < questionLen && handleQuestionChange(); // 选择答案后自动切换题目\r\n    }, 300);\r\n  };\r\n  // 切换题目\r\n  const handleQuestionChange = (): void => {\r\n    swiperRef.current?.swipeNext();\r\n  };\r\n  // 点击提交\r\n  const handleSubmit = (): void => {\r\n    dispatch?.({\r\n      type: 'setSelectAnswer',\r\n      selectAnswer: aswArr,\r\n    });\r\n    // Layer.open({\r\n    //   effect: 'bottom',\r\n    //   needCloseTag: true,\r\n    //   content: (\r\n    //     <Answer\r\n    //       hide={Layer.hide}\r\n    //       answer={aswArr}\r\n    //       tag={tag}\r\n    //       answerNum={questionLen}\r\n    //     />\r\n    //   ),\r\n    // });\r\n    setAnswerShow(true);\r\n  };\r\n  // 轮播图切换\r\n  const indicatorChange = (total: number, current: number): null => {\r\n    swiperPageRef.current = current + 1;\r\n    return null;\r\n  };\r\n\r\n  // 查询题目列表\r\n  useEffect(() => {\r\n    getQuestion({\r\n      variables: { subject, tagId },\r\n    });\r\n  }, [getQuestion, subject, tagId]);\r\n\r\n  // 缓存在state中正确答案\r\n  useEffect(() => {\r\n    const trueAnswer: TrueAnswer[] = [];\r\n    smartQuestions?.forEach((item: { checkAnswer: TrueAnswer }) =>\r\n      trueAnswer.push(item.checkAnswer)\r\n    );\r\n    dispatch?.({\r\n      type: 'setQuickTrueAnswer',\r\n      quickTrueAnswer: trueAnswer,\r\n    });\r\n    dispatch?.({\r\n      type: 'setQuick',\r\n      quick: smartQuestions,\r\n    });\r\n  }, [dispatch, smartQuestions]);\r\n  // 页面loading\r\n  useEffect(() => {\r\n    loading ? Toast.loading('加载中', 0) : Toast.hide();\r\n  }, [loading]);\r\n\r\n  // 监听跑马灯变化\r\n  const handleOnIndexChange = (): void => {\r\n    document.getElementById('quick_page')?.scrollTo(0, 0);\r\n    console.log(swiperPageRef.current);\r\n    setTimeout(() => {\r\n      if (smartQuestions.length === swiperPageRef.current) {\r\n        setIsShowResult(true);\r\n      } else {\r\n        setIsShowResult(false);\r\n      }\r\n    }, 500);\r\n  };\r\n  useEffect(() => {\r\n    // 只有一道题时候展示产看结果按钮\r\n    questionLen === 1 && setIsShowResult(true);\r\n  }, [questionLen]);\r\n\r\n  return (\r\n    <>\r\n      {questionLen > 0 && (\r\n        <Page id=\"quick_page\">\r\n          <HeaderBox>\r\n            <HeaderBlank />\r\n            <HeaderInner>\r\n              <Icon\r\n                type=\"cross\"\r\n                color=\"#262626\"\r\n                onClick={(): void => history.go(-1)}\r\n              />\r\n              <CutDown ref={cutDownRef} />\r\n            </HeaderInner>\r\n          </HeaderBox>\r\n          <CarouseBox>\r\n            <Swiper\r\n              defaultIndex={0}\r\n              loop={false}\r\n              indicator={indicatorChange}\r\n              ref={swiperRef}\r\n              onIndexChange={handleOnIndexChange}\r\n            >\r\n              {smartQuestions?.map((item: any, index: number) => {\r\n                const { question, questionId, options, _id } = item;\r\n                return (\r\n                  <Swiper.Item key={_id}>\r\n                    <HeaderBox className=\"lr-pd\">\r\n                      <GrayFont>\r\n                        {questionId} {tag}\r\n                      </GrayFont>\r\n                      <GrayFont>\r\n                        {index + 1}/{smartQuestions?.length}\r\n                      </GrayFont>\r\n                    </HeaderBox>\r\n                    <FontContent>{getMathpix(question)}</FontContent>\r\n                    <AnswerBox>\r\n                      {options?.map((optionItem: string, idx: number) => {\r\n                        return (\r\n                          <AnswerItem\r\n                            onClick={(): void => handleSelectAnswer(index, idx)}\r\n                            key={optionItem}\r\n                            className={\r\n                              aswArr[index as keyof typeof aswArr] ===\r\n                              numToLetter[idx as keyof typeof numToLetter]\r\n                                ? 'active'\r\n                                : ''\r\n                            }\r\n                          >\r\n                            {optionItem}\r\n                          </AnswerItem>\r\n                        );\r\n                      })}\r\n                    </AnswerBox>\r\n                  </Swiper.Item>\r\n                );\r\n              })}\r\n            </Swiper>\r\n          </CarouseBox>\r\n          <ButtonBox>\r\n            <ButtonBlank />\r\n            <ButtonBoxInner>\r\n              {isShowResult ? (\r\n                <Button type=\"primary\" onClick={handleSubmit}>\r\n                  提交\r\n                </Button>\r\n              ) : (\r\n                <Button type=\"primary\" onClick={handleQuestionChange}>\r\n                  下一题\r\n                </Button>\r\n              )}\r\n            </ButtonBoxInner>\r\n          </ButtonBox>\r\n        </Page>\r\n      )}\r\n      <LayerContainer effect=\"bottom\" needCloseTag visible={answerShow}>\r\n        <Answer\r\n          hide={(): void => setAnswerShow(false)}\r\n          answer={aswArr}\r\n          tag={tag}\r\n          answerNum={questionLen}\r\n          getTimeCounter={(): number => cutDownRef.current?.stop() || 0}\r\n        />\r\n      </LayerContainer>\r\n    </>\r\n  );\r\n};\r\n\r\nexport default Quick;\r\n"],"sourceRoot":""}