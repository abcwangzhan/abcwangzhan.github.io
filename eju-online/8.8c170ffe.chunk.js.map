{"version":3,"sources":["pages/Login/styles.ts","helpers/APIHelper.ts","pages/Login/regs.ts","pages/Setting/ChangePwd/ChangePwd.tsx"],"names":["themeColor","pkg","theme","Page","styled","div","PageTitle","PrimaryButton","props","mt","OthersBox","OthersItem","span","DrawerBox","ButtonBox","USER_SHOW","gql","USER_LOGIN","USER_RIGISTER","USER_COMPLETE","CHANGE_PWD","QUERY_INFORMATION","CREAT_FEEDBACK","emailReg","pwdReg","userNameReg","ChangePwd","history","useHistory","useState","formValues","setFormValues","useMutation","onCompleted","loginRes","changeSuccess","handleChangePwd","loading","data","goBack","handleChange","value","type","vals","placeholder","name","onChange","val","size","onClick","oldPassword","password","surePassword","info","test","checlValues","variables","id"],"mappings":"+3IAKMA,EAAaC,EAAIC,MAAM,iBAKhBC,EAAOC,IAAOC,IAAV,8SAkBJC,EAAYF,IAAOC,IAAV,+IAQTE,EAAgBH,YAAO,IAAPA,CAAH,uHAIV,SAACI,GAAD,OAA4BA,EAAMC,IAAM,KAG3CC,EAAYN,IAAOC,IAAV,wGAMTM,EAAaP,IAAOQ,KAAV,0CACZZ,GAGEa,EAAYT,IAAOC,IAAV,4FAMTS,EAAYV,IAAOC,IAAV,oI,kTCxDTU,EAAYC,YAAH,8aA2BTC,EAAaD,YAAH,mKASVE,EAAgBF,YAAH,2OAabG,EAAgBH,YAAH,u1BAiCbI,EAAaJ,YAAH,0JASVK,EAAoBL,YAAH,wKAajBM,EAAiBN,YAAH,wS,iCC3G3B,sGAAO,IAAMO,EACX,2DACWC,EACX,+EAEWC,EAAc,a,wPCiFZC,EA7Ea,WAC1B,IAAMC,EAAUC,cAChB,EAAoCC,mBAA0B,IAA9D,mBAAOC,EAAP,KAAmBC,EAAnB,KACA,EAAuCC,YAAYZ,IAAY,CAC7Da,YAAa,SAACC,GAAD,OAAcC,EAAcD,MAD3C,mBAAOE,EAAP,KAKMD,GALN,KAA0BE,QAKJ,SAACC,GAErBX,EAAQY,WAkCJC,EAAe,SAACC,EAAeC,GACnCX,GAAc,SAACY,GAAD,mBAAC,eAAeA,GAAhB,kBAAuBD,EAAOD,QAE9C,OACE,kBAAC,IAAD,KACE,kBAAC,IAAD,iCACA,uBACEG,YAAY,uCACZF,KAAK,WACLG,KAAK,cACLC,SAAU,SAACC,GAAD,OAAeP,EAAaO,EAAK,kBAE7C,uBAAYC,KAAK,OACjB,uBACEJ,YAAY,uCACZF,KAAK,WACLG,KAAK,WACLC,SAAU,SAACC,GAAD,OAAeP,EAAaO,EAAK,eAE7C,uBAAYC,KAAK,OACjB,uBACEJ,YAAY,6CACZF,KAAK,WACLG,KAAK,eACLC,SAAU,SAACC,GAAD,OAAeP,EAAaO,EAAK,mBAE7C,kBAAC,IAAD,CAAeL,KAAK,UAAUjC,GAAG,QAAQwC,QAlCxB,YAvBD,WAClB,IAAQC,EAAwCpB,EAAxCoB,YAAaC,EAA2BrB,EAA3BqB,SAAUC,EAAiBtB,EAAjBsB,aAC/B,QAAQ,GACN,MAAOF,EACL,IAAMG,KAAK,wCACX,MACF,MAAOF,EACL,IAAME,KAAK,wCACX,MACF,KAAK7B,IAAO8B,KAAKH,GAAY,IAC3B,IAAME,KAAK,sIACX,MACF,KAAKD,IAAiBD,EAEpB,IAAME,KAAK,sEACX,MACF,QACE,OAAO,EAEX,OAAO,GAKHE,IACFnB,EAAgB,CACdoB,UAAW,CAAEC,GAAI,MAAON,SAAUrB,EAAWqB,cA+B/C","file":"8.8c170ffe.chunk.js","sourcesContent":["import { Button } from 'antd-mobile';\r\nimport { ButtonProps } from 'antd-mobile/lib/button';\r\nimport styled from 'styled-px2vw';\r\nimport pkg from '../../../package.json';\r\n\r\nconst themeColor = pkg.theme['brand-primary'];\r\ninterface PrimaryButtonProps extends ButtonProps {\r\n  mt?: string;\r\n}\r\n\r\nexport const Page = styled.div`\r\n  padding: 40px 32px 0;\r\n  overflow: auto;\r\n  height: 100vh;\r\n  input {\r\n    font-size: 32px !important;\r\n  }\r\n  .am-checkbox-agree {\r\n    margin-left: 0;\r\n  }\r\n  .am-input-item {\r\n    padding-left: 0 !important;\r\n    .am-list-line {\r\n      padding-left: 30px;\r\n    }\r\n  }\r\n`;\r\n\r\nexport const PageTitle = styled.div`\r\n  text-align: center;\r\n  padding-bottom: 48px;\r\n  font-size: 40px;\r\n  letter-spacing: 20px;\r\n  font-weight: bold;\r\n`;\r\n\r\nexport const PrimaryButton = styled(Button)<PrimaryButtonProps>`\r\n  /* height: 100px;\r\n  line-height: 100px;\r\n  border-radius: 50px; */\r\n  margin-top: ${(props): string | number => props.mt || 0};\r\n`;\r\n\r\nexport const OthersBox = styled.div`\r\n  display: flex;\r\n  justify-content: space-between;\r\n  padding: 20px 32px;\r\n`;\r\n\r\nexport const OthersItem = styled.span`\r\n  color: ${themeColor};\r\n`;\r\n\r\nexport const DrawerBox = styled.div`\r\n  height: 75vh;\r\n  background-color: #fff;\r\n  padding: 0 30px;\r\n`;\r\n\r\nexport const ButtonBox = styled.div`\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: space-between;\r\n  padding-bottom: 100px;\r\n`;\r\n","import { gql } from '@apollo/client';\r\n\r\n// 获取用户信息\r\nexport const USER_SHOW = gql`\r\n  query userShow($id: ID!) {\r\n    user_show(_id: $id) {\r\n      user_name\r\n      art_science\r\n      eju_subject\r\n      birthday\r\n      gender\r\n      region\r\n      degree\r\n      japanese_ability {\r\n        certificate\r\n        point\r\n      }\r\n      english_ability {\r\n        certificate\r\n        point\r\n      }\r\n      goal_school\r\n      eju_point {\r\n        subject\r\n        point\r\n      }\r\n    }\r\n  }\r\n`;\r\n// 登录\r\nexport const USER_LOGIN = gql`\r\n  query userLogin($email: String!, $password: String!) {\r\n    user_login(email: $email, password: $password) {\r\n      _id\r\n    }\r\n  }\r\n`;\r\n\r\n// 注册\r\nexport const USER_RIGISTER = gql`\r\n  query addUserRegister(\r\n    $email: String!\r\n    $password: String!\r\n    $userName: String!\r\n  ) {\r\n    addUser_register(email: $email, password: $password, user_name: $userName) {\r\n      _id\r\n    }\r\n  }\r\n`;\r\n\r\n// 保存用户信息\r\nexport const USER_COMPLETE = gql`\r\n  mutation addUserInfo(\r\n    $artScience: String!\r\n    $ejuSubject: String!\r\n    $birthday: String\r\n    $region: String\r\n    $degree: String\r\n    $japaneseAbilityCertificate: String\r\n    $japaneseAbilityPoint: Int\r\n    $englishAbilityCertificate: String\r\n    $englishAbilityPoint: Int\r\n    $goalSchool: String\r\n    $ejuPoint: Int\r\n  ) {\r\n    addUser_adduserinfo(\r\n      art_science: $artScience\r\n      eju_subject_1: $ejuSubject\r\n      birthday: $birthday\r\n      region: $region\r\n      degree: $degree\r\n      japanese_ability_certificate: $japaneseAbilityCertificate\r\n      japanese_ability_point: $japaneseAbilityPoint\r\n      english_ability_certificate: $englishAbilityCertificate\r\n      english_ability_point: $englishAbilityPoint\r\n      goal_school: $goalSchool\r\n      eju_point: $ejuPoint\r\n    ) {\r\n      _id\r\n    }\r\n  }\r\n`;\r\n\r\n// 修改登录密码\r\nexport const CHANGE_PWD = gql`\r\n  mutation changPwd($id: String!, $password: String) {\r\n    changePW(_id: $id, password: $password) {\r\n      _id\r\n    }\r\n  }\r\n`;\r\n\r\n// 查询用户消息\r\nexport const QUERY_INFORMATION = gql`\r\n  query getInformation($id: ID!) {\r\n    information(_id: $id) {\r\n      _id\r\n      date\r\n      time\r\n      title\r\n      content\r\n    }\r\n  }\r\n`;\r\n\r\n// 用户反馈\r\nexport const CREAT_FEEDBACK = gql`\r\n  mutation creatFeedback(\r\n    $id: String!\r\n    $fbType: String\r\n    $fbContent: String\r\n    $fbImage: String\r\n  ) {\r\n    createFbEmail(\r\n      _id: $id\r\n      fb_type: $fbType\r\n      fb_content: $fbContent\r\n      fb_image: $fbImage\r\n    ) {\r\n      _id\r\n    }\r\n  }\r\n`;\r\n","export const emailReg =\r\n  /^\\w[-\\w.+]*@([A-Za-z0-9][-A-Za-z0-9]+\\.)+[A-Za-z]{2,14}$/;\r\nexport const pwdReg =\r\n  /^(?=.*[a-z])(?=.*[A-Z])(?=.*\\d)(?=.*[~!@#$%^&*()_+`\\-={}:\";'<>,.\\\\/]).{8,24}/;\r\n\r\nexport const userNameReg = /^\\w{8,24}/;\r\n","import React, { useState } from 'react';\r\nimport { WhiteSpace, InputItem, Toast } from 'antd-mobile';\r\nimport { useHistory } from 'react-router-dom';\r\nimport { useMutation } from '@apollo/client';\r\nimport { CHANGE_PWD } from '@/helpers/APIHelper';\r\nimport { ChangePwdValues } from '../types';\r\nimport { pwdReg } from '../../Login/regs';\r\nimport { Page, PageTitle, PrimaryButton } from '../../Login/styles';\r\n\r\nconst ChangePwd: React.FC = () => {\r\n  const history = useHistory();\r\n  const [formValues, setFormValues] = useState<ChangePwdValues>({}); // 表单值\r\n  const [handleChangePwd, { loading }] = useMutation(CHANGE_PWD, {\r\n    onCompleted: (loginRes) => changeSuccess(loginRes),\r\n  });\r\n\r\n  // 修改成功后\r\n  const changeSuccess = (data: { _id: string }): void => {\r\n    console.log(data);\r\n    history.goBack();\r\n  };\r\n  // 表单校验\r\n  const checlValues = (): boolean => {\r\n    const { oldPassword, password, surePassword } = formValues;\r\n    switch (false) {\r\n      case !!oldPassword:\r\n        Toast.info('请输入旧密码');\r\n        break;\r\n      case !!password:\r\n        Toast.info('请输入新密码');\r\n        break;\r\n      case pwdReg.test(password || ''):\r\n        Toast.info('请输入8-24位包含大小写字母数字及特殊字符的密码');\r\n        break;\r\n      case surePassword === password:\r\n        console.log(surePassword, password, surePassword !== password);\r\n        Toast.info('确认密码与密码保持一致');\r\n        break;\r\n      default:\r\n        return true;\r\n    }\r\n    return false;\r\n  };\r\n\r\n  // 提交更改密码\r\n  const handleSubmit = (): void => {\r\n    if (checlValues()) {\r\n      handleChangePwd({\r\n        variables: { id: '111', password: formValues.password },\r\n      });\r\n    }\r\n  };\r\n  // 表单值改变\r\n  const handleChange = (value: string, type: string): void => {\r\n    setFormValues((vals) => ({ ...vals, [type]: value }));\r\n  };\r\n  return (\r\n    <Page>\r\n      <PageTitle>更改密码</PageTitle>\r\n      <InputItem\r\n        placeholder=\"请输入原密码\"\r\n        type=\"password\"\r\n        name=\"oldPassword\"\r\n        onChange={(val): void => handleChange(val, 'oldPassword')}\r\n      />\r\n      <WhiteSpace size=\"lg\" />\r\n      <InputItem\r\n        placeholder=\"请输入新密码\"\r\n        type=\"password\"\r\n        name=\"password\"\r\n        onChange={(val): void => handleChange(val, 'password')}\r\n      />\r\n      <WhiteSpace size=\"lg\" />\r\n      <InputItem\r\n        placeholder=\"请输入确认密码\"\r\n        type=\"password\"\r\n        name=\"surePassword\"\r\n        onChange={(val): void => handleChange(val, 'surePassword')}\r\n      />\r\n      <PrimaryButton type=\"primary\" mt=\"286px\" onClick={handleSubmit}>\r\n        提交\r\n      </PrimaryButton>\r\n    </Page>\r\n  );\r\n};\r\n\r\nexport default ChangePwd;\r\n"],"sourceRoot":""}